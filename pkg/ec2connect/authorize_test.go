package ec2connect

import (
	"github.com/stretchr/testify/assert"
	"strings"
	"testing"
)

func TestNormalizeKey(t *testing.T) {
	key := `-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn
NhAAAAAwEAAQAAAQEA6h0I+mglxqIfgn8h4cJigVBZdmLDHu8848c6Tpf+byGTeLvs6iKX
GqIpdFFKlSIO0qIP42p1x8jkCnjuftMzmKyE4f3Kl1DBH0J4SKgtCUhOVh68rsV2QDHPD7
XG8elRQwNgz4rNpPVGVwEA1Kcdxf8mgzXc1rn1HooS2iMVjVCGzqnVl5yd3khnmX8YtZFJ
D9tTI58db2yeskNBv6M8S08BMf04h8xg21uEnAahSFVrCdH3l07qV/5MCHbIBgeF6KEgPH
tti8Afz2yBHN2oOyvJRcv48unCXOprsDoYYhj88mDO3IXlI8Ec6YsYyFSHlZF8jN8K+U2h
y4XipfQiXQAAA9jmSXbk5kl25AAAAAdzc2gtcnNhAAABAQDqHQj6aCXGoh+CfyHhwmKBUF
l2YsMe7zzjxzpOl/5vIZN4u+zqIpcaoil0UUqVIg7Sog/janXHyOQKeO5+0zOYrITh/cqX
UMEfQnhIqC0JSE5WHryuxXZAMc8Ptcbx6VFDA2DPis2k9UZXAQDUpx3F/yaDNdzWufUeih
LaIxWNUIbOqdWXnJ3eSGeZfxi1kUkP21Mjnx1vbJ6yQ0G/ozxLTwEx/TiHzGDbW4ScBqFI
VWsJ0feXTupX/kwIdsgGB4XooSA8e22LwB/PbIEc3ag7K8lFy/jy6cJc6muwOhhiGPzyYM
7cheUjwRzpixjIVIeVkXyM3wr5TaHLheKl9CJdAAAAAwEAAQAAAQEAgDQwQ3ifHzyPBtZ6
Bnh9mxUWOMdy1NDsRkxGuN1xXwhDCv3Wio0wtEwTaXhO4IZLGbvX+ZDGOQbhIn8BFACyo6
vuBRgHRn/ZkjXDSv6V0xx+kZi5ePf3fsYH/zFrZfSAJLOH43++h9Qtld2dx9ZQbqoAPCBV
9FzXR8cS9dP6rGxdYLALTLCuxJ8gpjbSZhb2aRuiFYkovEQjgTLfIGxIrd3SjPAV9X6XBn
mLNbVaj84u5squejEND9aRrmZ5fVh/B4ZsHd+rbLiHMaEgD22csjSZanavJnbYLd1xB/F7
s2VS+unzsluTKtuBSlq7TQ93wXZWHcED728Wdg3dZRaxXQAAAIEAzjZvlrrDhRezK1U09f
WxXoNc5ReyJVvufk6Q3KVnVsnBGnsVyHfSizxxIwC57jwv0m3LaJ4wfp9DNgvOfUk63DaC
bOMNwV6p5QlHVWmDPUjBgqiWZ0lmT890ZAEZLb3Ie3PGSONiC9x4KXExXNa+QvsGZYTAVn
9dslchTNLysb4AAACBAP6WhoN6zlZ0KGz7ziqYRoy4nJvsfPudyP1ARvmzSvKDuMYErYM4
cGbLoAZsnbI+77qUgz9CicJSeUVUASELnsQ2HMOhyDqeUm9P0KMbjhaTFMeE/WQOCQBBBH
T4h8F282GSKygTjppZ0ClSI/tiFM3jB5Nj3r069A8jrUFUSb+3AAAAgQDraXBhOOrfT9VB
/MWlvhkbbLGklR4MzxJ5PZyNh5ocnJs2137dreIeRpifFM54uADQpJpbiZgaEetrD4/+36
GykV+X17YB2yWLu7tE9AnXjE3n6qYnaC8nUprTCPeyfoREh1BRXSeARQ+Z9wdvD4iOQd7j
9aCsICbXzY5+GmtGiwAAABxhaWRhbi5zdGVlbGVATE0tQzAyVjUxVkRIVEQ2AQIDBAU=
-----END OPENSSH PRIVATE KEY-----
`
	normal, err := NormalizeKey(key)
	assert.NoError(t, err)

	expected := `ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDqHQj6aCXGoh+CfyHhwmKBUFl2YsMe7zzjxzpOl/5vIZN4u+zqIpcaoil0UUqVIg7Sog/janXHyOQKeO5+0zOYrITh/cqXUMEfQnhIqC0JSE5WHryuxXZAMc8Ptcbx6VFDA2DPis2k9UZXAQDUpx3F/yaDNdzWufUeihLaIxWNUIbOqdWXnJ3eSGeZfxi1kUkP21Mjnx1vbJ6yQ0G/ozxLTwEx/TiHzGDbW4ScBqFIVWsJ0feXTupX/kwIdsgGB4XooSA8e22LwB/PbIEc3ag7K8lFy/jy6cJc6muwOhhiGPzyYM7cheUjwRzpixjIVIeVkXyM3wr5TaHLheKl9CJd`
	assert.Equal(t, expected, strings.TrimSpace(normal))
}
